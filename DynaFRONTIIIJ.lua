-- revision 0.11
ACTIVE_FORCES = {}

BASE = {}
AIRFIELDS = {}
AIRFIELDS.RED = {}
AIRFIELDS.RED.ID = {}
AIRFIELDS.RED.NAME = {}
AIRFIELDS.RED.POS = {}
AIRFIELDS.BLUE = {}
AIRFIELDS.BLUE.ID = {}
AIRFIELDS.BLUE.NAME = {}
AIRFIELDS.BLUE.POS = {}



BASE.BLUE = {}
BASE.BLUE.HQ = {}

BASE.RED = {}
BASE.RED.HQ = {}

ACTIVE_FORCES.BLUE = {}
ACTIVE_FORCES.BLUE.TANK = {}
ACTIVE_FORCES.BLUE.TANK.ROUTE = {}
ACTIVE_FORCES.BLUE.TANK.POS = {}
ACTIVE_FORCES.BLUE.TANK.NAME = {}
ACTIVE_FORCES.BLUE.TANK.DATA = {}

ACTIVE_FORCES.BLUE.OILTRUCK = {}
ACTIVE_FORCES.BLUE.OILTRUCK.ROUTE = {}
ACTIVE_FORCES.BLUE.OILTRUCK.POS = {}
ACTIVE_FORCES.BLUE.OILTRUCK.NAME = {}
ACTIVE_FORCES.BLUE.OILTRUCK.DATA = {}

ACTIVE_FORCES.BLUE.AMMOTRUCK = {}
ACTIVE_FORCES.BLUE.AMMOTRUCK.ROUTE = {}
ACTIVE_FORCES.BLUE.AMMOTRUCK.POS = {}
ACTIVE_FORCES.BLUE.AMMOTRUCK.NAME = {}
ACTIVE_FORCES.BLUE.AMMOTRUCK.DATA = {}

ACTIVE_FORCES.BLUE.COMMAND = {}
ACTIVE_FORCES.BLUE.COMMAND.ROUTE = {}
ACTIVE_FORCES.BLUE.COMMAND.POS = {}
ACTIVE_FORCES.BLUE.COMMAND.NAME = {}
ACTIVE_FORCES.BLUE.COMMAND.DATA = {}

ACTIVE_FORCES.BLUE.ARTY = {}
ACTIVE_FORCES.BLUE.ARTY.ROUTE = {}
ACTIVE_FORCES.BLUE.ARTY.POS = {}
ACTIVE_FORCES.BLUE.ARTY.NAME = {}
ACTIVE_FORCES.BLUE.ARTY.DATA = {}

ACTIVE_FORCES.BLUE.AAA = {}
ACTIVE_FORCES.BLUE.AAA.ROUTE = {}
ACTIVE_FORCES.BLUE.AAA.POS = {}
ACTIVE_FORCES.BLUE.AAA.NAME = {}
ACTIVE_FORCES.BLUE.AAA.DATA = {}

ACTIVE_FORCES.BLUE.IFV = {}
ACTIVE_FORCES.BLUE.IFV.ROUTE = {}
ACTIVE_FORCES.BLUE.IFV.POS = {}
ACTIVE_FORCES.BLUE.IFV.NAME = {}
ACTIVE_FORCES.BLUE.IFV.DATA = {}

ACTIVE_FORCES.BLUE.SHORAD = {}
ACTIVE_FORCES.BLUE.SHORAD.ROUTE = {}
ACTIVE_FORCES.BLUE.SHORAD.POS = {}
ACTIVE_FORCES.BLUE.SHORAD.NAME = {}
ACTIVE_FORCES.BLUE.SHORAD.DATA = {}

ACTIVE_FORCES.BLUE.LRSAM = {}
ACTIVE_FORCES.BLUE.LRSAM.ROUTE = {}
ACTIVE_FORCES.BLUE.LRSAM.POS = {}
ACTIVE_FORCES.BLUE.LRSAM.NAME = {}
ACTIVE_FORCES.BLUE.LRSAM.DATA = {}


ACTIVE_FORCES.BLUE.MRSAM = {}
ACTIVE_FORCES.BLUE.MRSAM.ROUTE = {}
ACTIVE_FORCES.BLUE.MRSAM.POS = {}
ACTIVE_FORCES.BLUE.MRSAM.NAME = {}
ACTIVE_FORCES.BLUE.MRSAM.DATA = {}


ACTIVE_FORCES.BLUE.SRSAM = {}
ACTIVE_FORCES.BLUE.SRSAM.ROUTE = {}
ACTIVE_FORCES.BLUE.SRSAM.POS = {}
ACTIVE_FORCES.BLUE.SRSAM.NAME = {}
ACTIVE_FORCES.BLUE.SRSAM.DATA = {}


ACTIVE_FORCES.RED = {}
ACTIVE_FORCES.RED.TANK = {}
ACTIVE_FORCES.RED.TANK.ROUTE = {}
ACTIVE_FORCES.RED.TANK.POS = {}
ACTIVE_FORCES.RED.TANK.NAME = {}
ACTIVE_FORCES.RED.TANK.DATA = {}

ACTIVE_FORCES.RED.OILTRUCK = {}
ACTIVE_FORCES.RED.OILTRUCK.ROUTE = {}
ACTIVE_FORCES.RED.OILTRUCK.POS = {}
ACTIVE_FORCES.RED.OILTRUCK.NAME = {}
ACTIVE_FORCES.RED.OILTRUCK.DATA = {}

ACTIVE_FORCES.RED.AMMOTRUCK = {}
ACTIVE_FORCES.RED.AMMOTRUCK.ROUTE = {}
ACTIVE_FORCES.RED.AMMOTRUCK.POS = {}
ACTIVE_FORCES.RED.AMMOTRUCK.NAME = {}
ACTIVE_FORCES.RED.AMMOTRUCK.DATA = {}

ACTIVE_FORCES.RED.COMMAND = {}
ACTIVE_FORCES.RED.COMMAND.ROUTE = {}
ACTIVE_FORCES.RED.COMMAND.POS = {}
ACTIVE_FORCES.RED.COMMAND.NAME = {}
ACTIVE_FORCES.RED.COMMAND.DATA = {}

ACTIVE_FORCES.RED.ARTY = {}
ACTIVE_FORCES.RED.ARTY.ROUTE = {}
ACTIVE_FORCES.RED.ARTY.POS = {}
ACTIVE_FORCES.RED.ARTY.NAME = {}
ACTIVE_FORCES.RED.ARTY.DATA = {}

ACTIVE_FORCES.RED.AAA = {}
ACTIVE_FORCES.RED.AAA.ROUTE = {}
ACTIVE_FORCES.RED.AAA.POS = {}
ACTIVE_FORCES.RED.AAA.NAME = {}
ACTIVE_FORCES.RED.AAA.DATA = {}

ACTIVE_FORCES.RED.IFV = {}
ACTIVE_FORCES.RED.IFV.ROUTE = {}
ACTIVE_FORCES.RED.IFV.POS = {}
ACTIVE_FORCES.RED.IFV.NAME = {}
ACTIVE_FORCES.RED.IFV.DATA = {}

ACTIVE_FORCES.RED.SHORAD = {}
ACTIVE_FORCES.RED.SHORAD.ROUTE = {}
ACTIVE_FORCES.RED.SHORAD.POS = {}
ACTIVE_FORCES.RED.SHORAD.NAME = {}
ACTIVE_FORCES.RED.SHORAD.DATA = {}

ACTIVE_FORCES.RED.LRSAM = {}
ACTIVE_FORCES.RED.LRSAM.ROUTE = {}
ACTIVE_FORCES.RED.LRSAM.POS = {}
ACTIVE_FORCES.RED.LRSAM.NAME = {}
ACTIVE_FORCES.RED.LRSAM.DATA = {}

ACTIVE_FORCES.RED.MRSAM = {}
ACTIVE_FORCES.RED.MRSAM.ROUTE = {}
ACTIVE_FORCES.RED.MRSAM.POS = {}
ACTIVE_FORCES.RED.MRSAM.NAME = {}
ACTIVE_FORCES.RED.MRSAM.DATA = {}

ACTIVE_FORCES.RED.SRSAM = {}
ACTIVE_FORCES.RED.SRSAM.ROUTE = {}
ACTIVE_FORCES.RED.SRSAM.POS = {}
ACTIVE_FORCES.RED.SRSAM.NAME = {}
ACTIVE_FORCES.RED.SRSAM.DATA = {}

ACTIVE_FORCES.BLUE.PLANE = {}
ACTIVE_FORCES.BLUE.POS = {}
ACTIVE_FORCES.BLUE.PLANE.POSVEC2 = {}

ACTIVE_FORCES.RED.PLANE = {}
ACTIVE_FORCES.RED.POS = {}
ACTIVE_FORCES.RED.PLANE.POSVEC2 = {}

ACTIVE_BLUE_ZONE = nil
ACTIVE_RED_ZONE = nil

STRUCTURES = {}

STRUCTURES.BLUE = {}
STRUCTURES.BLUE.FACTORY = {}
STRUCTURES.BLUE.FACTORY.POS = {}

STRUCTURES.BLUE.FOB = {}
STRUCTURES.BLUE.FOB.POS = {}

STRUCTURES.BLUE.OIL = {}
STRUCTURES.BLUE.OIL.POS = {}

STRUCTURES.BLUE.DEPOT = {}
STRUCTURES.BLUE.DEPOT.POS = {}

STRUCTURES.RED = {}
STRUCTURES.RED.FACTORY = {}
STRUCTURES.RED.FACTORY.POS = {}

STRUCTURES.RED.FOB = {}
STRUCTURES.RED.FOB.POS = {}

STRUCTURES.RED.OIL = {}
STRUCTURES.RED.OIL.POS = {}

STRUCTURES.RED.DEPOT = {}
STRUCTURES.RED.DEPOT.POS = {}

SAM = {}
SAM.RED = {}
SAM.BLUE = {}



RT1 = "Faction Info"
RT2 = "Sitrep"
RT3 = "Purchase CAP Flight"
RT4 = "Purchase CAS Flight"
RT5 = "Purchase SEAD Flight"
RT6 = "Train Troops NOT AVAILABLE"
RT7 = "Purchase Tanks NOT AVAILABLE"
RT8 = "Purchase SAMS NOT AVAILABLE"
RT9 = "Purchase Factory NOT AVAILABLE"
RT10 = "Purchase Refinery NOT AVAILABLE"
RT11 = "Purchase Depot NOT AVAILABLE"
RT12 = "Purchase FOB NOT AVAILABLE"
RT13 = "Change Airfield NOT AVAILABLE"
RT14 = "Change Spawn Zone NOT AVAILABLE"

-- PARAMS
SAM.BLUE.LRSAM = {"BLUE LRSAM"}
SAM.BLUE.MRSAM = {"BLUE MRSAM"}
SAM.BLUE.SRSAM = {"BLUE SRSAM"}

SAM.RED.LRSAM = {"RED LRSAM"}
SAM.RED.MRSAM = {"RED MRSAM"}
SAM.RED.SRSAM = {"RED SRSAM"}

BLUE_SKILL = "average"
RED_SKILL = "average"

BLUE_COUNTRY = "USA"
RED_COUNTRY = "Russia"

BLUE_TECH_LEVEL = 0
RED_TECH_LEVEL = 0

RED_COUNTRY_ID = 0
BLUE_COUNTRY_ID = 2

--[[ COUNTRY IDS
0 Russia
1 Ukraine
2 USA
3 Turkey
4 UK
5 France
6 germany
8 Canada
9 Spain
10 The Netherlands
11 Belgium
12 Norway
13 Denmark
15 Israel
16 Georgia
17 Insurgents
18 Abkhazia
19 South Osetia
--]]

BATTLE_PHASE = 5 -- determines what phase the battle is in (5) is init state

-- initial industry on mission start
BLUE_FACTORY_AMOUNT = 3 -- how many active blue factories
BLUE_FOB_AMOUNT = 2 -- how many active blue factories
BLUE_DEPOT_AMOUNT = 1 -- how many active blue factories
BLUE_OIL_AMOUNT = 1 -- how many active blue factories

RED_FACTORY_AMOUNT = 3 -- how many active red factories
RED_FOB_AMOUNT = 2 -- how many active red factories
RED_DEPOT_AMOUNT = 1 -- how many active red factories
RED_OIL_AMOUNT = 1 -- how many active red factories

RED_OIL = 10
RED_PARTS = 10

BLUE_OIL = 10
BLUE_PARTS = 10
SMOKE_MARKER_UPDATE_SPEED = 75

FLIGHT_DELAY = 2200

BLUE_INIT_CAP = 400
BLUE_INIT_SEAD = 100
BLUE_INIT_CAS = 800

RED_INIT_CAP = 30
RED_INIT_SEAD = 150
RED_INIT_CAS = 800


--ATTACKER_RESPAWN_DELAY = 300 -- 5 minutes for new waves to be launched at the objective
--SAM_RESPAWN_DELAY = 2400 -- 40 minutes to respawn SAM systems
--DISBAND_PERCENT = 50 -- when a group is this hurt it is removed
--DISBAND_SAM_PERCENT = 90 -- when a group is this hurt it is removed for SAMS

PLACEMENT_ATTEMPTS = 200 -- how many tries to place within the polygon (be careful depending on the circumstances you could hang the game indefinetly with large numbers, suggest using low as possible unless a complex polygon with a huge trigger zone area over it)
red_radio =
{
    "Chameleon-1",
    "Chameleon-2",
    "Chameleon-3",

}
blue_radio =
{
    "Wankerpants-1",
    "Wankerpants-2",
    "Jacktronius-1",
}

-- NEVER TOUCH THESE AS THESE ARE INTERNAL GLOBAL GAME VARIABLES THAT NEVER NEED TO BE MODIFIED
GID = 0
UID = 0
SID = 0
--BLUE_COALITION_ID = 2
--RED_COALITION_ID = 1
--

function Set_Bases()
    if BATTLE_PHASE == 5 then
    BASE.BLUE = {
    [1] = 'Al Ain Intl',
    [2] = 'Al Maktoum Intl',
    [3] = 'Abu Dhabi Intl',
    [4] = 'Al Dhafra AFB',
    }
    BASE.RED = {
    [1] = 'Sharjah Intl',
    [2] = 'Fujairah Intl',
    [3] = 'Ras Al Khaimah Intl',
    [4] = 'Khasab',
    }

    BASE.RED.HQ = trigger.misc.getZone("Sharjah Intl")
    BASE.BLUE.HQ = trigger.misc.getZone("Al Ain Intl")
    end
end -- end func

function Generate_Income(useSide)
    if useSide == "RED" then
    RED_PARTS = RED_PARTS + Get_Factories("RED")
    RED_OIL = RED_PARTS + Get_Refineries("RED")
    end
    if useSide == "BLUE" then
    BLUE_PARTS = BLUE_PARTS + Get_Factories("BLUE")
    BLUE_OIL = RED_PARTS + Get_Refineries("RED")
    end
end

function Introduce_Mission() -- standard mission introduction function
	local msg = {}
	msg.text = 'OPERATION SAND CASTLE 0.09'
	msg.displayTime = 29  
	msg.msgFor = {coa = {'all'}} 
	mist.message.add(msg)
	msg = {}
	msg.text = 'Created by Chameleon_Silk and powered by MIST 4.5.xxx and DynafrontIII'
	msg.displayTime = 10 
	msg.msgFor = {coa = {'all'}} 
	mist.message.add(msg)
	--mist.scheduleFunction(displayLeaderInfo, {"BLUE"}, timer.getTime() + 10, 1200) -- display our blue leader info 10 seconds after launch and every 1200 seconds afterwards
	--mist.scheduleFunction(displayLeaderInfo, {"RED"}, timer.getTime() + 31, 1200) -- display our red leader info 10 seconds after launch and every 1200 seconds afterwards
	--mist.scheduleFunction(showResources, {"BLUE"}, timer.getTime() + 60, 2400) -- show our flights remaining for each side
	--mist.scheduleFunction(showResources, {"RED"}, timer.getTime() + 90, 2400)
end -- end func
				
function Sit_Rep()
    local msg = {}
        if BATTLE_PHASE == 5 then
        msg.text = ""
        msg.displayTime = 19  
        msg.msgFor = {coa = {'all'}} 
        mist.message.add(msg)
        msg = {}

        msg.text = 'Currently nothing to be said but will eventually provide players with a message as to the current taskings' 
        msg.displayTime = 19  
        msg.msgFor = {coa = {'all'}} 
        mist.message.add(msg)
        msg = {}
        end
end -- end func




function Mission_Start()
    -- called at mission start via trigger in the ME
        Set_Bases() -- use this to setup the bases for each side anytime a battle phase concludes (just before the new phase begins/mission start
    
        -- init the structures to our STRUCTURES database
    
        Init_Structures("BLUE", "OIL")
        Init_Structures("BLUE", "FACTORY")
        Init_Structures("BLUE", "DEPOT")
        Init_Structures("BLUE", "FOB")
    
        Init_Structures("RED", "OIL")
        Init_Structures("RED", "FACTORY")
        Init_Structures("RED", "DEPOT")
        Init_Structures("RED", "FOB")
    
       -- now create them
    
        Create_Industry("RED", "FOB") 
        Create_Industry("RED", "OIL")
        Create_Industry("RED", "FACTORY")
        Create_Industry("RED", "DEPOT")
       
        Create_Industry("BLUE", "FOB") 
        Create_Industry("BLUE", "FACTORY")
        Create_Industry("BLUE", "DEPOT")
        Create_Industry("BLUE", "OIL")
      
        -- add some forces to our ACTIVE_FORCES database
    
        Add_Fortified_Force("BLUE", "COMMAND", "FOB", 1, 200)
        --Add_Force("BLUE", "TANK", "FOB", 100, 9)
        --Add_Force("BLUE", "OILTRUCK", "OIL", 500, 5)
        --Add_Force("BLUE", "OILTRUCK", "AO", 500, 5)
        --Add_Force("BLUE", "AMMOTRUCK", "DEPOT", 500, 5)
        --Add_Force("BLUE", "AMMOTRUCK", "AO", 500, 5)
        Add_Fortified_Force("BLUE", "TANK", "FOB", 8, 3000)
        Add_Fortified_Force("BLUE", "AAA", "FOB", 2, 1500)
        
        Add_Fortified_Force("BLUE", "AAA", "DEPOT", 1, 1500)
        --Add_Force("BLUE", "AAA", "FACTORY", 50, 12)
        Add_Fortified_Force("BLUE", "OILTRUCK", "OIL", 1, 1000)
        Add_Fortified_Force("BLUE", "AMMOTRUCK", "DEPOT", 1, 1000)
        Add_Fortified_Force("BLUE", "AAA", "FACTORY", 1, 1000)
        Add_Fortified_Force("BLUE", "SHORAD", "FACTORY", 1, 1000)
        Add_Fortified_Force("BLUE", "SHORAD", "DEPOT", 1, 1000)
        --Add_Force("BLUE", "AAA", "FOB", 5500, 3)
        --Add_Force("BLUE", "ARTY", "AO", 500, 1)
        --Add_Force("BLUE", "IFV", "AO", 500, 2)
        --Add_Force("BLUE", "SHORAD", "AO", 500, 5)
    
        Add_Fortified_Force("RED", "COMMAND", "FOB", 1, 200)
        
        --Add_Force("RED", "OILTRUCK", "OIL", 500, 5)
        --Add_Force("RED", "OILTRUCK", "AO", 500, 5)
        --Add_Force("RED", "AMMOTRUCK", "DEPOT", 500, 5)
        --Add_Force("RED", "AMMOTRUCK", "AO", 500, 5)
        Add_Fortified_Force("RED", "TANK", "FOB", 8, 3000)
        Add_Fortified_Force("RED", "AAA", "FOB", 2, 1500)
        
        Add_Fortified_Force("RED", "AAA", "DEPOT", 1, 1500)
        --Add_Force("RED", "AAA", "AO", 250, 6)
        --Add_Force("RED", "AAA", "OIL", 50, 12)
        Add_Fortified_Force("RED", "OILTRUCK", "OIL", 1, 1000)
        Add_Fortified_Force("RED", "AMMOTRUCK", "DEPOT", 1, 1000)
        Add_Fortified_Force("RED", "AAA", "FACTORY", 1, 1000)
        Add_Fortified_Force("RED", "SHORAD", "FACTORY", 1, 1000)
        Add_Fortified_Force("RED", "SHORAD", "DEPOT", 1, 1000)
        
        
        --Add_Force("RED", "AAA", "FACTORY", 300, 3)
        --Add_Force("RED", "AAA", "FOB", 5500, 3)
        --Add_Force("RED", "ARTY", "AO", 500, 1)
        --Add_Force("RED", "IFV", "AO", 500, 4)
        --Add_Force("RED", "SHORAD", "AO", 500, 5)
    
        -- now create each category of them from our database
    
        Create_Things("BLUE", "TANK")
        Create_Things("BLUE", "OILTRUCK")
        Create_Things("BLUE", "AMMOTRUCK")
        Create_Things("BLUE", "COMMAND")
        Create_Things("BLUE", "IFV")
        Create_Things("BLUE", "AAA")
        Create_Things("BLUE", "SHORAD")
        Create_Things("BLUE", "ARTY")
    
        Create_Things("RED", "TANK")
        Create_Things("RED", "OILTRUCK")
        Create_Things("RED", "AMMOTRUCK")
        Create_Things("RED", "COMMAND")
        Create_Things("RED", "IFV")
        Create_Things("RED", "AAA")
        Create_Things("RED", "SHORAD")
        Create_Things("RED", "ARTY")

        Get_Airfields("BLUE")
        Get_Airfields("RED")

        Add_SAM("RED", "LRSAM", "AIRFIELDS", 0)
        Add_SAM("BLUE", "LRSAM", "AIRFIELDS", 0)

      
        --Add_SAM("BLUE", "MRSAM", "DEPOT", 0)
        --Add_SAM("RED", "MRSAM", "DEPOT", 0)

        Add_SAM("BLUE", "SRSAM", "FOB", 0)
        Add_SAM("RED", "SRSAM", "FOB", 0)
        --Add_SAM("RED", "MRSAM", "FOB", 0)
        --Add_SAM("RED", "MRSAM", 0)

        Add_SAM("BLUE", "MRSAM", "AIRFIELDS", 25)
        Add_SAM("RED", "MRSAM", "AIRFIELDS", 28)


        Create_SAM("BLUE", "LRSAM")
        Create_SAM("BLUE", "MRSAM")
        Create_SAM("BLUE", "SRSAM")

        Create_SAM("RED", "LRSAM")
        Create_SAM("RED", "MRSAM")
        Create_SAM("RED", "SRSAM")
        --Create_SAM("RED", "LRSAM")
        --Create_SAM("RED", "MRSAM")

        --Create_Templated_Thing("RED", "LRSAM", "INDUSTRY")
        --Create_Templated_Thing("RED", "LRSAM", "INDUSTRY")
        --Create_Templated_Thing("RED", "LRSAM", "INDUSTRY")
        --Create_Templated_Thing("RED", "LRSAM", "INDUSTRY")

        --Create_Flight(4, "BLUE","F-4E","SEAD")
        --Create_Flight(2, "BLUE","F-16A","CAP")
        --Create_Flight(2, "BLUE","A-10A","CAS")
        --Create_Flight(2, "BLUE","A-10A","CAS")

        --Create_Flight(4, "RED","Su-24M","SEAD")
        --Create_Flight(4, "RED","MiG-29A","CAP")
        --Create_Flight(2, "RED","MiG-29A","CAP")
        --Create_Flight(2, "RED","Su-25","CAS")
        --Create_Flight(2, "RED","Su-25T","SEAD")



        mist.scheduleFunction(Generate_Income, {"BLUE"}, timer.getTime() + 300) --
        mist.scheduleFunction(Generate_Income, {"RED"}, timer.getTime() + 300) --
        mist.scheduleFunction(random_markers, {50,250}, timer.getTime() + 10, SMOKE_MARKER_UPDATE_SPEED) -- add randoimized smoke markers (this is old code written 8+ years ago, maybe replace with more modern take on it at some point)

        mist.scheduleFunction(Create_Flight, {1, "BLUE","A-10A","CAS", 6}, timer.getTime() + BLUE_INIT_CAS, FLIGHT_DELAY) -- placeholders for now so we have some air traffic to fight
        mist.scheduleFunction(Create_Flight, {2, "BLUE","F-4E","SEAD", 25}, timer.getTime() + BLUE_INIT_SEAD, FLIGHT_DELAY) -- 
        mist.scheduleFunction(Create_Flight, {2, "BLUE","AV8BNA","SEAD", 25}, timer.getTime() + BLUE_INIT_SEAD + 120, FLIGHT_DELAY) -- 
        mist.scheduleFunction(Create_Flight, {2, "BLUE","F-16A","CAP", 25}, timer.getTime() + BLUE_INIT_CAP, FLIGHT_DELAY)
        mist.scheduleFunction(Create_Flight, {1, "BLUE","F/A-18A","CAP", 25}, timer.getTime() + BLUE_INIT_CAP + 60, FLIGHT_DELAY)
        mist.scheduleFunction(Create_Flight, {1, "BLUE","F-14A","CAP", 25}, timer.getTime() + BLUE_INIT_CAP + 120, FLIGHT_DELAY)
        mist.scheduleFunction(Create_Flight, {1, "BLUE","F-15C","CAP", 25}, timer.getTime() + BLUE_INIT_CAP + 180, FLIGHT_DELAY)
        --mist.scheduleFunction(Create_Flight, {2, "BLUE","B-1B","CAS", 25}, timer.getTime() + BLUE_INIT_CAS + 240, FLIGHT_DELAY)
        
        mist.scheduleFunction(Create_Flight, {1, "RED","Su-25","CAS", 10}, timer.getTime() + RED_INIT_CAS, FLIGHT_DELAY) -- 
        mist.scheduleFunction(Create_Flight, {2, "RED","Su-24M","SEAD", 28}, timer.getTime() + RED_INIT_SEAD, FLIGHT_DELAY) -- 
        mist.scheduleFunction(Create_Flight, {2, "RED","Su-25T","SEAD", 28}, timer.getTime() + RED_INIT_SEAD + 120, FLIGHT_DELAY) -- 
        mist.scheduleFunction(Create_Flight, {2, "RED","MiG-29A","CAP", 1}, timer.getTime() + RED_INIT_CAP, FLIGHT_DELAY)
        mist.scheduleFunction(Create_Flight, {2, "RED","MiG-29A","CAP", 1}, timer.getTime() + RED_INIT_CAP, FLIGHT_DELAY)
        mist.scheduleFunction(Create_Flight, {2, "RED","MiG-29S","CAP", 1}, timer.getTime() + RED_INIT_CAP + 60, FLIGHT_DELAY)
        mist.scheduleFunction(Create_Flight, {1, "RED","MiG-23MLD","CAP", 1}, timer.getTime() + RED_INIT_CAP + 120, FLIGHT_DELAY)
        mist.scheduleFunction(Create_Flight, {1, "RED","MiG-25PD","CAP", 1}, timer.getTime() + RED_INIT_CAP + 180, FLIGHT_DELAY)
        mist.scheduleFunction(Create_Flight, {2, "RED","MiG-21Bis","CAP", 1}, timer.getTime() + RED_INIT_CAP + 240, FLIGHT_DELAY)
        mist.scheduleFunction(Create_Flight, {1, "RED","Su-27","CAP", 1}, timer.getTime() + RED_INIT_CAP, FLIGHT_DELAY)
        --mist.scheduleFunction(Create_Flight, {2, "RED","Tu-22M3","CAS", 10}, timer.getTime() + RED_INIT_CAS + 15,  FLIGHT_DELAY) -- 

        --mist.scheduleFunction(Update_Flight_Positions, {"BLUE"}, timer.getTime() + 20,  20) -- 
        --mist.scheduleFunction(Update_Flight_Positions, {"RED"}, timer.getTime() + 20,  20) -- 
        --mist.scheduleFunction(Garbage_Collector, {"BLUE"}, timer.getTime() + 40, 60)
        --mist.scheduleFunction(Garbage_Collector, {"RED"}, timer.getTime() + 40, 60)

        Dynamic_Structure_Marker("BLUE", "FOB")
        Dynamic_Structure_Marker("RED", "FOB")
        Dynamic_Structure_Marker("BLUE", "OIL")
        Dynamic_Structure_Marker("RED", "OIL")
        Dynamic_Structure_Marker("BLUE", "DEPOT")
        Dynamic_Structure_Marker("RED", "DEPOT")
        Dynamic_Structure_Marker("BLUE", "FACTORY")
        Dynamic_Structure_Marker("RED", "FACTORY")


        Dynamic_Airfield_Marker("RED")
        Dynamic_Airfield_Marker("BLUE")

        -- add some markers over the targets for both sides to see
    
        Dynamic_Troop_Markers("BLUE", "TANK", 500)
        Dynamic_Troop_Markers("BLUE", "AAA", 4000)
        Dynamic_Troop_Markers("BLUE", "LRSAM", 12000)

        Dynamic_Troop_Markers("BLUE", "SHORAD", 6000)
        --Dynamic_Troop_Markers("BLUE", "AMMOTRUCK")
        --Dynamic_Troop_Markers("BLUE", "OILTRUCK")
        --Dynamic_Troop_Markers("BLUE", "COMMAND")
        
        Dynamic_Troop_Markers("RED", "TANK", 500)
        Dynamic_Troop_Markers("RED", "AAA", 4000)
        Dynamic_Troop_Markers("RED", "LRSAM", 12000)
        
        Dynamic_Troop_Markers("RED", "SHORAD", 6000)
        --Dynamic_Troop_Markers("RED", "AMMOTRUCK")
        --Dynamic_Troop_Markers("RED", "OILTRUCK")
        --Dynamic_Troop_Markers("RED", "COMMAND")
    
        --mist.scheduleFunction(Dynamic_Troop_Markers, {"BLUE", "TANK"}, timer.getTime() + 2,  60) -- 
        --mist.scheduleFunction(Dynamic_Troop_Markers, {"RED", "TANK"}, timer.getTime() + 2,  60) -- 

    end -- end func

    function Purchase_Flight(useSide,typeOf)

        if useSide == "BLUE" then
            if typeOf == "CAP" then
                Create_Flight(2, "BLUE","F-16A","CAP")
            end
    
            if typeOf == "CAS" then
                Create_Flight(2, "BLUE","A-10A","CAS")
            end
    
            if typeOf == "SEAD" then
                Create_Flight(2, "BLUE","Su-24M","SEAD")
            end   
        end
    
        if useSide == "BLUE" then
            if typeOf == "CAP" then
                Create_Flight(2, "RED","MiG-29A","CAP")
            end
    
            if typeOf == "CAS" then
                Create_Flight(2, "RED","Su-25","CAS")
            end
    
            if typeOf == "SEAD" then
                Create_Flight(2, "RED","Su-24M","SEAD")
            end   
        end
    end -- end func

function Dynamic_Troop_Markers(useSide, kindOf, size)
    for forces = 1, #ACTIVE_FORCES[useSide][kindOf].NAME do
        local v = {}
        local v2 = {}

        if useSide == "BLUE" then
        v.color = {0,0,255,255}    
        v2.color = {0,0,255,255}    
        v.fillColor = {0,0,100,15} -- filled with 100 alpha
        v2.fillColor = {0,0,100,15} -- filled with 100 alpha
        v.markForCoa = 1
        v2.markForCoa = 1
        end

        if useSide == "RED" then
        v.color = {255,0,0,255}        
        v2.color = {255,0,0,255}        
        v.fillColor = {100,0,0,15} -- filled with 255 alpha
        v2.fillColor = {100,0,0,15} -- filled with 255 alpha
        v.markForCoa = 2
        v2.markForCoa = 2
        end
        v.readOnly = true
        v2.readOnly = true
        
        v2.text = kindOf
        v.pos = ACTIVE_FORCES[useSide][kindOf].POS[forces]
        v2.pos = ACTIVE_FORCES[useSide][kindOf].POS[forces]
        v2.fontSize = 12
        v.id = useSide .. " " .. kindOf .. " " .. ACTIVE_FORCES[useSide][kindOf].NAME[forces]
        v2.id = useSide .. " " .. kindOf .. " " .. ACTIVE_FORCES[useSide][kindOf].NAME[forces] .. "TEXT"
        --v.markForCoa = 2
        v.mType = 2
        v2.mType = 5
        v.radius = size
        mist.marker.add(v)
        mist.marker.add(v2)
        end

end -- end func

function Dynamic_Structure_Marker(useSide, kindOf)
    for structures = 1, #STRUCTURES[useSide][kindOf] do
        local v = {}

        if useSide == "BLUE" then
        v.color = {0,0,255,25}        
        v.fillColor = {155,155,155,75} -- filled with 25 alpha
        end

        if useSide == "RED" then
        v.color = {255,0,0,25}        
        v.fillColor = {155,155,155,75} -- filled with 25 alpha
        end
        v.readOnly = true
        v.pos = STRUCTURES[useSide][kindOf].POS[structures]
        v.id = useSide .. " " .. kindOf .. " " .. structures
        --v.markForCoa = 2
        v.mType = 2
        v.radius = 7500
        mist.marker.add(v)
        end

end -- end func

function Dynamic_Airfield_Marker(useSide)

    -- = #AIRFIELDS[useSide].ID

    for afs = 1, #AIRFIELDS[useSide].ID do
        local v = {}

        if useSide == "BLUE" then
        v.color = {0,0,255,255}        
        v.fillColor = {0,0,255,35} -- filled with 25 alpha
        end

        if useSide == "RED" then
        v.color = {255,0,0,255}        
        v.fillColor = {255,0,0,35} -- filled with 25 alpha
        end
        v.readOnly = true
        v.pos = AIRFIELDS[useSide].POS[afs]
        v.id = AIRFIELDS[useSide].NAME[afs]
        --v.markForCoa = 2
        v.mType = 2
        v.radius = 20000
        mist.marker.add(v)
    end

    --local data = mist.utils.serialize("DUMPED:", data) -- debug to show us our table
    --trigger.action.outText(lengthArr,160, false)
    --show_data(AIRFIELDS.BLUE)
    --misc.trigger.outText(#AIRFIELDS[useSide])

end -- end func


function Update_Flight_Positions(useSide)

    --trigger.action.outText(data,160, false)
    --show_data(ACTIVE_FORCES[useSide].PLANE, "planes:")
    local unitData = {}
    for planes = 1, #ACTIVE_FORCES[useSide].PLANE do
        if Group.getByName(ACTIVE_FORCES[useSide].PLANE[planes]):isExist() then
            -- that group exists
            local thatGroup = Group.getByName(ACTIVE_FORCES[useSide].PLANE[planes])
            local unitSize = Group.getSize(thatGroup)

            for units = 1, unitSize do
                local myUnit = thatGroup:getUnit(units)
                unitData[units] = Object.getPoint(myUnit)
            end

            if ACTIVE_FORCES[useSide].PLANE[planes].DATAPOS ~= nil then
                ACTIVE_FORCES[useSide].PLANE[planes].OLDDATAPOS = ACTIVE_FORCES[useSide].PLANE[planes].DATAPOS
            end

            ACTIVE_FORCES[useSide].PLANE[planes].DATAPOS = unitData
            

        else
            table.remove(ACTIVE_FORCES[useSide].PLANE[planes])
            table.remove(ACTIVE_FORCES[useSide].PLANE[planes].DATAPOS)
            -- to do remove the entry        
        end
    end
    
end -- end func



function Init_Structures(forSide, typeOf)
    -- since the battle has just begun and no buildings have been setup by either team lets create our first structures and add them to the list
    
        if typeOf == "FACTORY" then
            for factoryParser = 1, BLUE_FACTORY_AMOUNT do
            local zone = Get_Phase(forSide, "FACTORY")
            local poly = Get_Poly(forSide, "FACTORY")
            STRUCTURES[forSide].FACTORY[factoryParser] = "Factory " .. factoryParser
            STRUCTURES[forSide].FACTORY.POS[factoryParser] = Check_Point_In_Poly(zone, poly)
            end
        end
        if typeOf == "FOB" then
            for fobParser = 1, BLUE_FOB_AMOUNT do
            local zone = Get_Phase(forSide, "FOB")
            local poly = Get_Poly(forSide, "FOB")
            STRUCTURES[forSide].FOB[fobParser] = "FOB " .. fobParser
            STRUCTURES[forSide].FOB.POS[fobParser] = Check_Point_In_Poly(zone, poly)
            end
        end
        if typeOf == "DEPOT" then
            for depotParser = 1, BLUE_DEPOT_AMOUNT do
            local zone = Get_Phase(forSide, "DEPOT")
            local poly = Get_Poly(forSide, "DEPOT")
            STRUCTURES[forSide].DEPOT[depotParser] = "Supply Depot " .. depotParser
            STRUCTURES[forSide].DEPOT.POS[depotParser] = Check_Point_In_Poly(zone, poly)
            end
        end
        if typeOf == "OIL" then
            for oilParser = 1, BLUE_OIL_AMOUNT do
            local zone = Get_Phase(forSide, "OIL")
            local poly = Get_Poly(forSide, "OIL")
            STRUCTURES[forSide].OIL[oilParser] = "Oil Refinery " .. oilParser
            STRUCTURES[forSide].OIL.POS[oilParser] = Check_Point_In_Poly(zone, poly)
            end
        end 

end -- end func


    
function Create_Industry(useSide, kindOf)
-- after init of structures use this function to create the different kinds of buildings
    for parseList = 1, #STRUCTURES[useSide][kindOf] do
    local newCoord = STRUCTURES[useSide][kindOf].POS[parseList] -- use the new location as the spawn point
    
    v = 
    {
    type = Determine_Structure(kindOf), 
    country = Get_Country(useSide), 
    category = Determine_Category_Static(kindOf), 
    x = newCoord.x,
    y = newCoord.y,
    }

    mist.dynAddStatic(v)
end
    
end -- end func

function Against_Side(uS)
local useSide = uS
local againstSide = "NEUTRAL"
if useSide == "BLUE" then
    againstSide = "RED"
end

if useSide == "RED" then
    againstSide = "BLUE"
end

return againstSide
end -- end func




function Add_Fortified_Force(uS, kO, wA, aG, dist)
local useSide = uS
local kindOf = kO
local whichArea = wA
local amountGroups = aG
local lengthArr = 0
local entryIndex = 1
local newIndex = 1
local againstSide = Against_Side(useSide)

lengthArrStructure = #STRUCTURES[useSide][whichArea].POS

    
if lengthArrStructure ~= 0 then
    newIndex = #ACTIVE_FORCES[useSide][kindOf].POS
    for counter = 1, lengthArrStructure do
        
        for countergroups = 1, amountGroups do
            newIndex = newIndex + 1
            local positionalData = STRUCTURES[useSide][whichArea].POS[counter]
            local newy = positionalData.y  + (dist * math.sin(math.random(0, 2)))
            local newx = positionalData.x  + (dist * math.sin(math.random(0, 2)))
            local grpName = "Fortified " .. kindOf .. " at " .. whichArea .. GID 
            ACTIVE_FORCES[useSide][kindOf].POS[newIndex] = {x = newx, y = newy}

            local newGroupDataNoUnits =
            {
            country = Get_Country(useSide),
            --coalitionId = Get_Coalition(sideString),
            groupName = grpName,
            units = { },
            coalition = useSide,
            groupId = GID,
            category = "vehicle",
            countryId = Get_Country_Id(useSide),
            startTime = 0,
            task = "Ground Nothing",
            hidden = false,
            }
            --show_data(newGroupDataNoUnits) -- debug usage
            -- note that I am stripping the units part for the creation process function and not the adding to database one
            ACTIVE_FORCES[useSide][kindOf].NAME[newIndex] = "Fortified " .. kindOf .. " at " .. whichArea .. GID 
            ACTIVE_FORCES[useSide][kindOf].DATA[newIndex] = newGroupDataNoUnits -- store the group data for later
            local plan = Get_Battle_Plans(useSide, againstSide, kindOf) -- get the plan for this entry (the groups routing data)
            ACTIVE_FORCES[useSide][kindOf].ROUTE[newIndex] = plan -- add the route to the database for this entry
            GID = GID + 1 -- make sure we never use this identifier again
        end
    end
end




end -- end func



  --- Creates a position in the database for a force
  -- string "RED" or "BLUE"
  -- string "TANK", "IFV", "INFANTRY", "AAA", "AMMOTRUCK", "OILTRUCK", "SHORAD", "COMMAND", "SRSAM", "MRSAM", "LRSAM"
  -- string "AO", "INDUSTRY", "BASE"
  -- number radius
  -- number of groups
function Add_Force(uS, kO, wA, nR, aG)
local sideString = uS
local kindOf = kO
local whichArea = wA
local newRadius = nR
local amountGroups = aG

for cycles = 1, amountGroups do
local againstSide = Against_Side(sideString)
local plan = Get_Battle_Plans(sideString, againstSide, kindOf) -- get the plan for this entry (the groups routing data)
local grpName = ""

--if whichArea ~= "AO" then
 --   local zoneToUse = Get_Phase(sideString, whichArea)
 --   local restrictPoly = Get_Poly(sideString, whichArea)
 --   ACTIVE_FORCES[sideString][kindOf].POS[cycles] = Check_Point_In_Poly(zoneToUse, restrictPoly)
    
--end

        local zoneToUse = Get_Phase(sideString, whichArea)
        local restrictPoly = Get_Poly(sideString, whichArea)
        ACTIVE_FORCES[sideString][kindOf].POS[cycles] = Check_Point_In_Poly(zoneToUse, restrictPoly)
        --show_data(ACTIVE_FORCES[sideString][kindOf].POS[cycles])


    
    grpName = sideString .. " " .. kindOf .. " " .. GID .. " from " .. whichArea -- get its name ready
    ACTIVE_FORCES[sideString][kindOf].NAME[cycles] = grpName -- store the group name
    ACTIVE_FORCES[sideString][kindOf].ROUTE[cycles] = plan -- add the route to the database for this entry

    -- now create the group data table without the units filled in
    local newGroupDataNoUnits =
    {
    country = Get_Country(sideString),
    --coalitionId = Get_Coalition(sideString),
    groupName = grpName,
    units = { },
    coalition = sideString,
    groupId = GID,
    category = "vehicle",
    countryId = Get_Country_Id(sideString),
    startTime = 0,
    task = "Ground Nothing",
    hidden = false,
    }
     --show_data(newGroupDataNoUnits) -- debug usage
    -- note that I am stripping the units part for the creation process function and not the adding to database one
    ACTIVE_FORCES[sideString][kindOf].DATA[cycles] = newGroupDataNoUnits -- store the group data for later
    GID = GID + 1 -- make sure we never use this identifier again
end

end -- end func


function Create_Things(uS, kO)
local useSide = uS
local kindOf = kO
local unitSelected = Determine_Unit(useSide, kindOf) -- determine what type of unit (considers the factions tech level)
local skillLevel = Get_Skill(useSide)
local unitsNum = Get_Unit_Numbers(useSide, kindOf)
local totalUnitData = {}

    for forces = 1, #ACTIVE_FORCES[useSide][kindOf].DATA do 

        local newGroupData = ACTIVE_FORCES[useSide][kindOf].DATA[forces]  
        local positionalData = ACTIVE_FORCES[useSide][kindOf].POS[forces]
        newGroupData.clone = false


        for unitsCount = 1, unitsNum do

            local newUnitData =
            {
            heading = 1.44, -- will need something to point the units correct facing this is just dummy data for now
            unitId = UID,
            skill = skillLevel,
            --wp.y = wp.y + (50 * math.sin(math.random(10)))
            y = positionalData.y  + (50 * math.sin(math.random(10))),
            x = positionalData.x  + (50 * math.sin(math.random(10))),
            unitName =  ACTIVE_FORCES[useSide][kindOf].NAME[forces].. " Unit " .. unitsCount,
            playerCanDrive = true,
            type = unitSelected,
            }
        
            totalUnitData[unitsCount] = newUnitData
        end

        newGroupData.units = totalUnitData
                    
        for unitNumber, newUnitData in pairs(newGroupData.units) do -- for each unit index, and unit data

            local spacing = 20 * unitNumber
            newGroupData.units[unitNumber].x = newGroupData.units[unitNumber].x - spacing -- place the unit offset by this much
            newGroupData.units[unitNumber].y = newGroupData.units[unitNumber].y + spacing -- place the unit offset by this much
        end
  
        if ACTIVE_FORCES[useSide][kindOf].ROUTE[forces] ~= nil then
        newGroupData.route = ACTIVE_FORCES[useSide][kindOf].ROUTE[forces]
        end

        local newGroup = mist.dynAdd(newGroupData)
        newGroup.lateActivation = false
        newGroup.visible = true
        Group.activate(Group.getByName(ACTIVE_FORCES[useSide][kindOf].DATA[forces].groupName))
        UID = UID + 1 -- make sure never to use the same unitId again
    end          

end -- end func
    

-- HELPER FUNCTIONS BELOW

function Remove_Force(groupName, forSide, kindOf)
-- reserved
end -- end func

    function Debug_Deployment(radius)
    local v = {}
    v.pos = trigger.misc.getZone("DEPLOYMENT ZONE")
    v.id = "Debug marker"
    --v.markForCoa = 2
    v.mType = 2
    v.radius = radius
    mist.marker.add(v)
    end


function Show_Data(dat, label, length, clear)
local data = mist.utils.serialize(label, dat) -- debug to show us our table
trigger.action.outText(data,length,clear)

end -- end func


function Get_Skill(useSide)

    if useSide == "BLUE" then
    skill = BLUE_SKILL_LEVEL
    end

    if useSide == "RED" then
    skill = RED_SKILL_LEVEL
    end

return skill
end -- end func

function Get_Factories(useSide)

    if useSide == "BLUE" then
    factories = BLUE_FACTORY_AMOUNT
    end
    if useSide == "RED" then
    factories = RED_FACTORY_AMOUNT
    end

return factories
end -- end func

function Get_Refineries(useSide)

    if useSide == "BLUE" then
    refineries = BLUE_OIL_AMOUNT
    end
    if useSide == "RED" then
    refineries = RED_OIL_AMOUNT
    end

return factories
end -- end func

function Get_Coalition(useSide)

    if useSide == "BLUE" then
    coalId = BLUE_COALITION_ID
    end

    if useSide == "RED" then
    coalId = RED_COALITION_ID
    end

return coalId
end -- end func    

function Get_Country(useSide)

    if useSide == "BLUE" then
    forceSide = BLUE_COUNTRY
    end

    if useSide == "RED" then
    forceSide = RED_COUNTRY
    end

return forceSide
end -- end func


function Get_Country_Id(useSide)

    if useSide == "BLUE" then
    forceSide = BLUE_COUNTRY_ID
    end

    if useSide == "RED" then
    forceSide = RED_COUNTRY_ID
    end

return forceSide
end -- end func


function Get_Tech(useSide)

    if useSide == "BLUE" then
    forceTech = BLUE_TECH_LEVEL
    end

    if useSide == "RED" then
    forceTech = RED_TECH_LEVEL
    end

return forceTech
end

function Determine_Unit(useSide, kindOf)
local selectedUnit = ""

    techLevel = Get_Tech(useSide)

    if useSide == "BLUE" then

        if kindOf == "TANK" then

            if techLevel == 0 then
            selectedUnit = "M-60"
            end

            if techLevel == 1 then
            selectedUnit = "Leopard1A3"
            end

            if techLevel == 2 then
            selectedUnit = "Leopard-2"
            end

            if techLevel == 3 then
            selectedUnit = "M-1 Abrams"
            end
        end

        if kindOf == "OILTRUCK" then
        selectedUnit = "M978 HEMTT Tanker"
        end

        if kindOf == "AMMOTRUCK" then
        selectedUnit = "M 818"
        end

        if kindOf == "COMMAND" then
        selectedUnit = "Predator GCS"
        end

        if kindOf == "AAA" then
        selectedUnit = "Vulcan"
        end

        if kindOf == "SHORAD" then
        selectedUnit = "M1097 Avenger"
        end

        if kindOf == "IFV" then
        selectedUnit = "LAV-25"
        end

        if kindOf == "ARTY" then
        selectedUnit = "M-109"
        end

    end


    if useSide == "RED" then

        if kindOf == "TANK" then

            if techLevel == 0 then
                selectedUnit = "T-55"
            end

            if techLevel == 1 then
                selectedUnit = "T-72B"
            end

            if techLevel == 2 then
                selectedUnit = "T-72B3"
            end

            if techLevel == 3 then
                selectedUnit = "T-80UD"
            end
        end

        if kindOf == "OILTRUCK" then
        selectedUnit = "ATZ-10"
        end

        if kindOf == "AMMOTRUCK" then
        selectedUnit = "Ural-4320T"
        end

        if kindOf == "COMMAND" then
        selectedUnit = "ZiL-131 APA-80"
        end

        if kindOf == "AAA" then
        selectedUnit = "ZSU-23-4 Shilka"
        end

        if kindOf == "SHORAD" then
        selectedUnit = "Tor 9A331"
        end

        if kindOf == "IFV" then
        selectedUnit = "BTR-80"
        end

        if kindOf == "ARTY" then
        selectedUnit = "Uragan_BM-27"
        end

    end

return selectedUnit
end -- end func


function Get_Battle_Plans(useSide, againstSide, kindOf) -- sets the new triggerzones used for the spawning of new units depending on the phasing of the mission
local plan = ""
local enemyLoc = ""
local newPos = {}
local newPos2 = {}
local newPos3 = {}

    if kindOf == "TANK" or kindOf == "IFV" then -- or kindOf == "ARTY" then
    plan = "P" .. BATTLE_PHASE .. " " .. useSide .. " " .. kindOf .. " ROUTE"
    enemyLoc = "P" .. BATTLE_PHASE .. " " .. againstSide .. " ZONE"
    local route = mist.getGroupRoute(plan, true)
    --
    --trigger.action.outText(enemyLoc,35, false)
    newPos = mist.getRandomPointInZone(enemyLoc)
    newPos2 = mist.getRandomPointInZone(enemyLoc)
    newPos3 = mist.getRandomPointInZone(enemyLoc)
 
    route[2].x = newPos.x
    route[2].y = newPos.y
    route[1].x = newPos2.x
    route[1].y = newPos2.y

    return route
    end
    
end -- end func

function Get_Unit_Numbers(useSide, kindOf)
    if useSide == "BLUE" then
        if kindOf == "TANK" then
        unitsNum = Get_Factories(useSide)
        end

        if kindOf == "COMMAND" then
        unitsNum = 1
        end

        if kindOf == "AMMOTRUCK" then
        unitsNum = 8
        end

        if kindOf == "OILTRUCK" then
            unitsNum = 8
        end

        if kindOf == "SHORAD" then
            unitsNum = 1
        end

        if kindOf == "AAA" then
            unitsNum = 4
        end

        if kindOf == "ARTY" then
            unitsNum = 8
        end

        if kindOf == "IFV" then
            unitsNum = 6
        end
    end

    if useSide == "RED" then
        if kindOf == "TANK" then
        unitsNum = Get_Factories(useSide)
        unitsNum = unitsNum * 2
        end

        if kindOf == "COMMAND" then
        unitsNum = 1
        end

        if kindOf == "AMMOTRUCK" then
        unitsNum = 8
        end

        if kindOf == "OILTRUCK" then
            unitsNum = 8
        end

        if kindOf == "SHORAD" then
            unitsNum = 1
        end

        if kindOf == "AAA" then
            unitsNum = 4
        end

        if kindOf == "ARTY" then
            unitsNum = 8
        end

        if kindOf == "IFV" then
            unitsNum = 6
        end
    end

return unitsNum
end -- end func

function Get_Phase(useSide, whichArea)     
local phase = ""
if whichArea == "AO" or whichArea == "FOB" or whichArea == "DEPOT" then
        phase = "P" .. BATTLE_PHASE .. " " .. useSide .. " ZONE"
else
        phase = useSide .. " INDUSTRY"
end
return phase
end -- end func

function Get_Poly(useSide, whichArea)
local poly = ""

if whichArea == "AO" or whichArea == "FOB" or whichArea == "DEPOT" then
    poly = "P" .. BATTLE_PHASE .. " " .. useSide .. " POLY"
else
    poly = useSide .. " INDUSTRY POLY"
end

return poly
end -- end func

function Create_TZ(nZ, nX, nY, nR)
    local newZ = nZ
    local newX = nX
    local newY = nY
    local newRadius = nR
    local newPoint =
    {
    z = newZ,
    x = newX,
    y = newY
    }
    local newZone =
    {
    radius = newRadius,
    point = newPoint
    }

return newZone
end -- end func

function Check_Point_In_Poly(zR, pR)
    for attempts = 1, PLACEMENT_ATTEMPTS do
        local finished = false
        local zoneReference = zR
        local polyReference = pR
        local point = mist.getRandomPointInZone(zoneReference)
        finished = mist.pointInPolygon(point, mist.getGroupPoints(polyReference))

        if finished then
        return point
        end

        if attempts == PLACEMENT_ATTEMPTS then
            trigger.action.outText("ERROR: SOMETHING FAILED TO FIND A VALID POSITION!!!", 5)
        return nil
        end
    end
        
end -- end func

function Determine_Structure(kO)
    local kindOf = kO
    local structureTypeName = ""
    
    if kindOf == "FACTORY" then
        structureTypeName = "Workshop A"
    end

    if kindOf == "DEPOT" then
        structureTypeName = ".Ammunition depot" 
    end

    if kindOf == "OIL" then
        structureTypeName = "Repair workshop"
    end

    if kindOf == "FOB" then
        structureTypeName = ".Command Center"   
    end
    
return structureTypeName
end -- end func

function Determine_Category_Static(kO)
    local kindOf = kO
    local structureCat = 0
        
    if kindOf == "FACTORY" then
        structureCat = "Fortifications" 
    end

    if kindOf == "DEPOT" then
        structureCat = "Warehouses"
    end

    if kindOf == "OIL" then
        structureCat = "Fortifications"
    end

    if kindOf == "FOB" then
        structureCat = ".Command Center"
    end
        
return structureCat
end -- end func

function Flight_Plan(start_pos, aId, againstSide, tasking)
local points = {}
local enemyLoc = "P" .. BATTLE_PHASE .. " " .. againstSide .. " ZONE"
local AOzone = trigger.misc.getZone(enemyLoc)
local AOpos1 = mist.getRandPointInCircle(AOzone.point, 25000, 5000)
local AOpos2 = mist.getRandPointInCircle(AOzone.point, 35000, 15000)

points[#points + 1] = mist.fixedWing.buildWP(start_pos, "Turning Point", 0, 0, "BARO")
points[#points + 1] = mist.fixedWing.buildWP(mist.getRandPointInCircle(start_pos, 20000, 10000), "Turning Point", 0, 0, "BARO")
points[#points + 1] = mist.fixedWing.buildWP(AOpos1, "Turning Point", 0, 0, "BARO")
points[#points + 1] = mist.fixedWing.buildWP(AOpos2, "Turning Point", 0, 0, "BARO")
points[#points + 1] = mist.fixedWing.buildWP(mist.getRandPointInCircle(start_pos, 40000, 35000), "Turning Point", 0, 0, "BARO")
points[#points + 1] = mist.fixedWing.buildWP(start_pos, "Turning Point", 0, 0, "BARO")

points[1] = mist.fixedWing.buildWP(start_pos)
points[1].type = "TakeOffParking"
points[1].airdromeId = aId
points[1].action = "From Parking Area"
points[5].type = "Land"
points[5].airdromeId = aId
points[5].action = "Landing"




if tasking == "CAP" then
    trigger.action.outText("CAP FLIGHT", 10)
    
    points[1].speed = 200
    points[1].alt = 4000
    points[2].speed = 300
    points[3].alt = 9000
    points[3].speed = 900
    points[4].speed = 400
    points[4].alt = 4000
points[1].alt = 9000
points[1].task =
{ 
        ["id"] = "ComboTask",
        ["params"] = 
        {
            ["tasks"] = 
            {
                [2] = 
                {
                    ["number"] = 2,
                    ["auto"] = true,
                    ["id"] = "WrappedAction",
                    ["enabled"] = true,
                    ["params"] = 
                    {
                        ["action"] = 
                        {
                            ["id"] = "Option",
                            ["params"] = 
                            {
                                ["value"] = true,
                                ["name"] = 17,
                            }, -- end of ["params"]
                        }, -- end of ["action"]
                    }, -- end of ["params"]
                }, -- end of [2]
                [3] = 
                {
                    ["number"] = 3,
                    ["auto"] = true,
                    ["id"] = "WrappedAction",
                    ["enabled"] = true,
                    ["params"] = 
                    {
                        ["action"] = 
                        {
                            ["id"] = "Option",
                            ["params"] = 
                            {
                                ["value"] = 4,
                                ["name"] = 18,
                            }, -- end of ["params"]
                        }, -- end of ["action"]
                    }, -- end of ["params"]
                }, -- end of [3]
                [1] = 
                {
                    ["number"] = 1,
                    ["key"] = "CAP",
                    ["id"] = "EngageTargets",
                    ["enabled"] = true,
                    ["auto"] = true,
                    ["params"] = 
                    {
                        ["targetTypes"] = 
                        {
                            [1] = "Air",
                        }, -- end of ["targetTypes"]
                        ["priority"] = 0,
                    }, -- end of ["params"]
                }, -- end of [1]
                [4] = 
                {
                    ["number"] = 4,
                    ["auto"] = true,
                    ["id"] = "WrappedAction",
                    ["enabled"] = true,
                    ["params"] = 
                    {
                        ["action"] = 
                        {
                            ["id"] = "Option",
                            ["params"] = 
                            {
                                ["value"] = true,
                                ["name"] = 19,
                            }, -- end of ["params"]
                        }, -- end of ["action"]
                    }, -- end of ["params"]
                }, -- end of [4]
                [5] = 
                {
                    ["number"] = 5,
                    ["auto"] = true,
                    ["id"] = "WrappedAction",
                    ["enabled"] = true,
                    ["params"] = 
                    {
                        ["action"] = 
                        {
                            ["id"] = "Option",
                            ["params"] = 
                            {
                                ["targetTypes"] = 
                                {
                                }, -- end of ["targetTypes"]
                                ["noTargetTypes"] = 
                                {
                                    [1] = "Fighters",
                                    [2] = "Multirole fighters",
                                    [4] = "Helicopters",
                                    [8] = "Tanks",
                                    [16] = "LR SAM",
                                    [17] = "Aircraft Carriers",
                                    [9] = "IFV",
                                    [18] = "Cruisers",
                                    [5] = "UAVs",
                                    [10] = "APC",
                                    [20] = "Frigates",
                                    [21] = "Corvettes",
                                    [11] = "Artillery",
                                    [22] = "Light armed ships",
                                    [3] = "Bombers",
                                    [6] = "Infantry",
                                    [12] = "Unarmed vehicles",
                                    [24] = "Submarines",
                                    [19] = "Destroyers",
                                    [25] = "Cruise missiles",
                                    [13] = "AAA",
                                    [26] = "Antiship Missiles",
                                    [27] = "AA Missiles",
                                    [7] = "Fortifications",
                                    [14] = "SR SAM",
                                    [28] = "AG Missiles",
                                    [23] = "Unarmed ships",
                                    [29] = "SA Missiles",
                                    [15] = "MR SAM",
                                }, -- end of ["noTargetTypes"]
                                ["name"] = 21,
                                ["value"] = "none;",
                            }, -- end of ["params"]
                        }, -- end of ["action"]
                    }, -- end of ["params"]
                }, -- end of [5]
            }, -- end of ["tasks"]
        }, -- end of ["params"]
    } -- end of ["task"]

    points[2].task = 
    {
        ["id"] = "ComboTask",
        ["params"] = 
        {
            ["tasks"] = 
            {
                [1] = 
                {
                    ["number"] = 1,
                    ["auto"] = false,
                    ["id"] = "EngageTargets",
                    ["enabled"] = true,
                    ["params"] = 
                    {
                        ["targetTypes"] = 
                        {
                            [1] = "Air",
                        }, -- end of ["targetTypes"]
                        ["priority"] = 0,
                        ["value"] = "Air;",
                        ["noTargetTypes"] = 
                        {
                            [7] = "Unarmed vehicles",
                            [1] = "Infantry",
                            [2] = "Fortifications",
                            [4] = "IFV",
                            [8] = "AAA",
                            [9] = "SR SAM",
                            [5] = "APC",
                            [10] = "MR SAM",
                            [3] = "Tanks",
                            [6] = "Artillery",
                            [12] = "Light armed ships",
                            [11] = "LR SAM",
                        }, -- end of ["noTargetTypes"]
                        ["maxDistEnabled"] = true,
                        ["maxDist"] = 105000,
                    }, -- end of ["params"]
                }, -- end of [1]
            }, -- end of ["tasks"]
        }, -- end of ["params"]
    } -- end of ["task"]
end

if tasking == "CAS" then
    trigger.action.outText("CAS FLIGHT", 10)

    points[1].speed = 150
    points[1].alt = 2000
    points[2].speed = 250
    points[3].alt = 2000
    points[3].speed = 350
    points[4].alt = 2000
    points[4].speed = 350
    			points[1].task = 
				{
					["id"] = "ComboTask",
					["params"] = 
					{
						["tasks"] = 
						{
							[6] = 
							{
								["enabled"] = true,
								["auto"] = true,
								["id"] = "WrappedAction",
								["number"] = 6,
								["params"] = 
								{
									["action"] = 
									{
										["id"] = "Option",
										["params"] = 
										{
											["value"] = true,
											["name"] = 19,
										}, -- end of ["params"]
									}, -- end of ["action"]
								}, -- end of ["params"]
							}, -- end of [6]
							[2] = 
							{
								["enabled"] = true,
								["auto"] = true,
								["id"] = "WrappedAction",
								["number"] = 2,
								["params"] = 
								{
									["action"] = 
									{
										["id"] = "Option",
										["params"] = 
										{
											["value"] = 1,
											["name"] = 3,
										}, -- end of ["params"]
									}, -- end of ["action"]
								}, -- end of ["params"]
							}, -- end of [2]
							[3] = 
							{
								["enabled"] = true,
								["auto"] = true,
								["id"] = "WrappedAction",
								["number"] = 3,
								["params"] = 
								{
									["action"] = 
									{
										["id"] = "Option",
										["params"] = 
										{
											["variantIndex"] = 2,
											["value"] = 131074,
											["name"] = 5,
											["formationIndex"] = 2,
										}, -- end of ["params"]
									}, -- end of ["action"]
								}, -- end of ["params"]
							}, -- end of [3]
							[1] = 
							{
								["enabled"] = true,
								["auto"] = true,
								["id"] = "WrappedAction",
								["number"] = 1,
								["params"] = 
								{
									["action"] = 
									{
										["id"] = "Option",
										["params"] = 
										{
											["value"] = 2,
											["name"] = 1,
										}, -- end of ["params"]
									}, -- end of ["action"]
								}, -- end of ["params"]
							}, -- end of [1]
							[4] = 
							{
								["enabled"] = true,
								["auto"] = true,
								["id"] = "WrappedAction",
								["number"] = 4,
								["params"] = 
								{
									["action"] = 
									{
										["id"] = "Option",
										["params"] = 
										{
											["value"] = true,
											["name"] = 15,
										}, -- end of ["params"]
									}, -- end of ["action"]
								}, -- end of ["params"]
							}, -- end of [4]
							[5] = 
							{
								["enabled"] = true,
								["auto"] = true,
								["id"] = "WrappedAction",
								["number"] = 5,
								["params"] = 
								{
									["action"] = 
									{
										["id"] = "Option",
										["params"] = 
										{
											["targetTypes"] = 
											{
											}, -- end of ["targetTypes"]
											["noTargetTypes"] = 
											{
												[1] = "Fighters",
												[2] = "Multirole fighters",
												[4] = "Helicopters",
												[8] = "Tanks",
												[16] = "LR SAM",
												[17] = "Aircraft Carriers",
												[9] = "IFV",
												[18] = "Cruisers",
												[5] = "UAVs",
												[10] = "APC",
												[20] = "Frigates",
												[21] = "Corvettes",
												[11] = "Artillery",
												[22] = "Light armed ships",
												[3] = "Bombers",
												[6] = "Infantry",
												[12] = "Unarmed vehicles",
												[24] = "Submarines",
												[19] = "Destroyers",
												[25] = "Cruise missiles",
												[13] = "AAA",
												[26] = "Antiship Missiles",
												[27] = "AA Missiles",
												[7] = "Fortifications",
												[14] = "SR SAM",
												[28] = "AG Missiles",
												[23] = "Unarmed ships",
												[29] = "SA Missiles",
												[15] = "MR SAM",
											}, -- end of ["noTargetTypes"]
											["name"] = 21,
											["value"] = "none;",
										}, -- end of ["params"]
									}, -- end of ["action"]
								}, -- end of ["params"]
							}, -- end of [5]
						}, -- end of ["tasks"]
					}, -- end of ["params"]
				} -- end of ["task"]      
                
                
                points[2].task = 
                    {
                        ["id"] = "ComboTask",
                        ["params"] = 
                        {
                            ["tasks"] = 
                            {
                                [1] = 
                                {
                                    ["enabled"] = true,
                                    ["auto"] = false,
                                    ["id"] = "EngageTargetsInZone",
                                    ["number"] = 1,
                                    ["params"] = 
                                    {
                                        ["y"] = points[2].y,
                                        ["x"] = points[2].x,
                                        ["targetTypes"] = 
                                        {
                                            [6] = "AAA",
                                            [2] = "Infantry",
                                            [3] = "Fortifications",
                                            [1] = "Air",
                                            [4] = "Armored vehicles",
                                            [5] = "Artillery",
                                            [7] = "Naval",
                                        }, -- end of ["targetTypes"]
                                        ["value"] = "Air;Infantry;Fortifications;Armored vehicles;Artillery;AAA;Naval;",
                                        ["noTargetTypes"] = 
                                        {
                                            [1] = "Unarmed vehicles",
                                            [2] = "SR SAM",
                                            [4] = "LR SAM",
                                            [3] = "MR SAM",
                                        }, -- end of ["noTargetTypes"]
                                        ["priority"] = 0,
                                        ["zoneRadius"] = 50000,
                                    }, -- end of ["params"]
                                }, -- end of [1]
                            }, -- end of ["tasks"]
                        }, -- end of ["params"]
                    } -- end of ["task"]

                    points[3].task = 
                    {
                        ["id"] = "ComboTask",
                        ["params"] = 
                        {
                            ["tasks"] = 
                            {
                                [1] = 
                                {
                                    ["enabled"] = true,
                                    ["auto"] = false,
                                    ["id"] = "EngageTargetsInZone",
                                    ["number"] = 1,
                                    ["params"] = 
                                    {
                                        ["y"] = points[3].y,
                                        ["x"] = points[3].x,
                                        ["targetTypes"] = 
                                        {
                                            [6] = "AAA",
                                            [2] = "Infantry",
                                            [3] = "Fortifications",
                                            [1] = "Air",
                                            [4] = "Armored vehicles",
                                            [5] = "Artillery",
                                            [7] = "Naval",
                                        }, -- end of ["targetTypes"]
                                        ["value"] = "Air;Infantry;Fortifications;Armored vehicles;Artillery;AAA;Naval;",
                                        ["noTargetTypes"] = 
                                        {
                                            [1] = "Unarmed vehicles",
                                            [2] = "SR SAM",
                                            [4] = "LR SAM",
                                            [3] = "MR SAM",
                                        }, -- end of ["noTargetTypes"]
                                        ["priority"] = 0,
                                        ["zoneRadius"] = 50000,
                                    }, -- end of ["params"]
                                }, -- end of [1]
                            }, -- end of ["tasks"]
                        }, -- end of ["params"]
                    } -- end of ["task"]

                   
end


if tasking == "SEAD" then
    trigger.action.outText("SEAD FLIGHT", 10)

    points[1].speed = 200
    points[1].alt = 2000
    points[2].speed = 250
    points[3].alt = 8000
    points[3].speed = 450
    points[4].alt = 2000
    points[4].speed = 350
    points[2].task = 
    {
        ["id"] = "ComboTask",
        ["params"] = 
        {
            ["tasks"] = 
            {
                [6] = 
                {
                    ["number"] = 6,
                    ["auto"] = true,
                    ["id"] = "WrappedAction",
                    ["enabled"] = true,
                    ["params"] = 
                    {
                        ["action"] = 
                        {
                            ["id"] = "Option",
                            ["params"] = 
                            {
                                ["targetTypes"] = 
                                {                                    
                                    [1] = "MR SAM",
                                    [2] = "SR SAM",
                                    [3] = "LR SAM",
                                    [4] = "AAA",
                                    [5] = "Helicopters",
                                    [6] = "Tanks",
                                    --[15] = "MR SAM",
                                }, -- end of ["targetTypes"]
                                ["noTargetTypes"] = 
                                {

                                }, -- end of ["noTargetTypes"]
                                ["name"] = 21,
                                --["value"] = "none;",
                            }, -- end of ["params"]
                        }, -- end of ["action"]
                    }, -- end of ["params"]
                }, -- end of [6]
                [2] = 
                {
                    ["number"] = 2,
                    ["auto"] = true,
                    ["id"] = "WrappedAction",
                    ["enabled"] = true,
                    ["params"] = 
                    {
                        ["action"] = 
                        {
                            ["id"] = "Option",
                            ["params"] = 
                            {
                                ["value"] = 2,
                                ["name"] = 1,
                            }, -- end of ["params"]
                        }, -- end of ["action"]
                    }, -- end of ["params"]
                }, -- end of [2]
                [3] = 
                {
                    ["number"] = 3,
                    ["auto"] = true,
                    ["id"] = "WrappedAction",
                    ["enabled"] = true,
                    ["params"] = 
                    {
                        ["action"] = 
                        {
                            ["id"] = "Option",
                            ["params"] = 
                            {
                                ["value"] = 1,
                                ["name"] = 3,
                            }, -- end of ["params"]
                        }, -- end of ["action"]
                    }, -- end of ["params"]
                }, -- end of [3]
                [1] = 
                {
                    ["number"] = 1,
                    ["key"] = "SEAD",
                    ["id"] = "EngageTargets",
                    ["enabled"] = true,
                    ["auto"] = false,
                    ["params"] = 
                    {
                        ["targetTypes"] = 
                        {
                            [1] = "MR SAM",
                            [2] = "SR SAM",
                            [3] = "LR SAM",
                            [4] = "AAA",
                            [5] = "Helicopters",
                            [6] = "Tanks",
                        }, -- end of ["targetTypes"]
                        ["priority"] = 0,
                    }, -- end of ["params"]
                }, -- end of [1]
                [4] = 
                {
                    ["number"] = 4,
                    ["auto"] = true,
                    ["id"] = "WrappedAction",
                    ["enabled"] = true,
                    ["params"] = 
                    {
                        ["action"] = 
                        {
                            ["id"] = "Option",
                            ["params"] = 
                            {
                                ["variantIndex"] = 2,
                                ["value"] = 131074,
                                ["name"] = 5,
                                ["formationIndex"] = 2,
                            }, -- end of ["params"]
                        }, -- end of ["action"]
                    }, -- end of ["params"]
                }, -- end of [4]
                [5] = 
                {
                    ["number"] = 5,
                    ["auto"] = true,
                    ["id"] = "WrappedAction",
                    ["enabled"] = true,
                    ["params"] = 
                    {
                        ["action"] = 
                        {
                            ["id"] = "Option",
                            ["params"] = 
                            {
                                ["value"] = true,
                                ["name"] = 15,
                            }, -- end of ["params"]
                        }, -- end of ["action"]
                    }, -- end of ["params"]
                }, -- end of [5]
                [7] = 
                {
                    ["number"] = 7,
                    ["auto"] = true,
                    ["id"] = "WrappedAction",
                    ["enabled"] = true,
                    ["params"] = 
                    {
                        ["action"] = 
                        {
                            ["id"] = "Option",
                            ["params"] = 
                            {
                                ["value"] = true,
                                ["name"] = 19,
                            }, -- end of ["params"]
                        }, -- end of ["action"]
                    }, -- end of ["params"]
                }, -- end of [7]
            }, -- end of ["tasks"]
        }, -- end of ["params"]
    } -- end of ["task"]
    --Show_Debug(points[1].task, 10)
end

local route = {}
route.points = points
return route
end -- end func


function Create_Flight(size, useSide, templateAircraft, tasking)

local type = templateAircraft .. " " .. tasking

allUnits = {}


local Airfields = Get_Airfields(useSide)

if Airfields == false then
    trigger.action.outText("NO AIRPORT TO SPAWN PLANE, ABORTING", 5)
    return false
end

local rand = mist.random(1, #AIRFIELDS[useSide].ID)
airfieldId = AIRFIELDS[useSide].ID[rand]
airfieldPos = AIRFIELDS[useSide].POS[rand]



local name = useSide .. " " .. templateAircraft .. " " .. GID

local arrLength = #ACTIVE_FORCES[useSide].PLANE
ACTIVE_FORCES[useSide].PLANE[arrLength + 1] = name
--show_data(ACTIVE_FORCES[useSide].PLANE)

for unitNum = 1, size do

units =
{
    alt = 248,
    heading = 0,
    alt_type = "BARO", -- is this right maybe use BARO?
    skill = "average",
    type = templateAircraft,
    payload = mist.getPayload(type),
    callsign =
    {
    [1] = 3,
    [2] = #ACTIVE_FORCES[useSide].PLANE,
    [3] = numUnits,
    name = useSide .. " " .. templateAircraft .. " Pilot " .. UID
    },
    
}

allUnits[unitNum] = units
end



  vars = {}

  vars.units = allUnits
  --vars.groupName = "test"
  vars.name = name
  --vars.clone = false
  vars.route = Flight_Plan(airfieldPos, airfieldId, useSide, tasking)
  vars.hidden = false
--group_data.country = template_group.country
vars.country = Get_Country(useSide)
vars.category = "AIRPLANE"
vars.task = tasking
vars.taskselected = true


ACTIVE_FORCES[useSide].PLANE[arrLength + 1] = {name}
newGroup = mist.dynAdd(vars)


--trigger.action.outText(mist.utils.tableShow(newGroup), 25)

--Dump_ME_Groups()
--mist.scheduleFunction(Tasking, {newGroup.name}, timer.getTime() + 10, 11, timer.getTime() + 12) -- display our blue leader info 10 seconds after launch and every 1200 seconds afterwards

mist.scheduleFunction(Set_Flight_Location, {useSide, vars.units, name, arrLength + 1}, timer.getTime() + 10) -- display our blue leader info 10 seconds after launch and every 1200 seconds afterwards

--Show_Data(vars.units, "UNIT DATA")

--Set_Flight_Location(useSide, vars.units, name)



GID = GID + 1

end -- end func


function Set_Flight_Location(useSide, units, grpName, indexNo)
    local thatGroup = Group.getByName(grpName)
    local airUnits = Group.getUnits(thatGroup)
    local positions = {}
    
    for k, v in pairs(airUnits) do
        local pos = v:getPosition()
        local posVec2 = {x = pos.p.x, y = pos.p.z}
    
        table.insert(positions, posVec2)
    end
    
    --Show_Data(positions, "units")
    --Show_Data(ACTIVE_FORCES[useSide].PLANE[indexNo], "pd:" )

    ACTIVE_FORCES[useSide].PLANE[indexNo].POSVEC2 = positions
    
    --Show_Data(ACTIVE_FORCES[useSide].PLANE[indexNo].POSVEC2, "posdata:" )

end

function Garbage_Collector(useSide)
    for allAir = 1, #ACTIVE_FORCES[useSide].PLANE do
        if ACTIVE_FORCES[useSide].PLANE ~= nil then
            Show_Data(ACTIVE_FORCES[useSide].PLANE[allAir].POSVEC2, "OLD", 5, true) 
            local thatGroup = Group.getByName(ACTIVE_FORCES[useSide].PLANE[allAir][1])
            local airUnits = Group.getUnits(thatGroup)

            for k, v in pairs(airUnits) do
                local pos = v:getPosition()
                local posVec2 = {x = pos.p.x, y = pos.p.z}

                if posVec2 ~= ACTIVE_FORCES[useSide].PLANE[allAir][1].POSVEC2 then
                ACTIVE_FORCES[useSide].PLANE[allAir].POSVEC2 = posVec2
                Show_Data(ACTIVE_FORCES[useSide].PLANE[allAir].POSVEC2, "NEW", 5, false) 
                else
                trigger.action.outText("DESTROYED A GROUP", 10) 
                Group.Destroy(thatGroup)
                end
            end

        end
    end

end -- end func

function Tasking(grpName, task)
   -- local group = Group.getByName(grpName)
   --Dump(grpName)
    if Group.getByName(grpName) and Group.getByName(grpName):isExist() then
        --trigger.action.outText("Exist", 10)

        local ctl = grpName:getController()

        if task == "CAP" then
            ctl:setOption(0, 1) --weapon free, open fire weapon free, open fire, return fire, weapon hold
            ctl:setOption(1, 3) --no reaction, passive, evade, bypass, allow abort
            ctl:setOption(4, 1) --cms never, against missile, in sam wez, near enemies
            ctl:setOption(3, 2) --radar using never, attack only, for search, continuous
            ctl:setOption(6, 1) --rtb on bingo
            --ctl:setOption(10, 1) --rtb on bingo
            ctl:setOption(6, 0) --alarm state, auto, green, red
            ctl:setOption(15, 1) --prohibit jettison
            ctl:setOption(25, 1) --jettison tanks if empty
            end

            if task == "CAS" then
                ctl:setOption(0, 0) --weapon free, open fire weapon free, open fire, return fire, weapon hold
                ctl:setOption(1, 0) --no reaction, passive, evade, bypass, allow abort
                ctl:setOption(4, 2) --cms never, against missile, in sam wez, near enemies
                ctl:setOption(3, 1) --radar using never, attack only, for search, continuous
                ctl:setOption(6, 1) --rtb on bingo
                --ctl:setOption(10, 1) --rtb on bingo
                ctl:setOption(6, 0) --alarm state, auto, green, red
                ctl:setOption(15, 1) --prohibit jettison
                ctl:setOption(25, 1) --jettison tanks if empty
                end

                if task == "SEAD" then
                    ctl:setOption(0, 1) --weapon free, open fire weapon free, open fire, return fire, weapon hold
                    ctl:setOption(1, 4) --no reaction, passive, evade, bypass, allow abort
                    ctl:setOption(4, 3) --cms never, against missile, in sam wez, near enemies
                    ctl:setOption(3, 3) --radar using never, attack only, for search, continuous
                    ctl:setOption(6, 1) --rtb on bingo
                    --ctl:setOption(10, 1) --rtb on bingo
                    ctl:setOption(6, 0) --alarm state, auto, green, red
                    ctl:setOption(15, 1) --prohibit jettison
                    ctl:setOption(25, 1) --jettison tanks if empty
                    end

        
   else 
        trigger.action.outText("Controller does NOT exist !!!", 10) 
   end
   
end -- end func




-- example: "BLUE", "AIRFIELDS", "LRSAM", 0
-- example2: "RED", "FOB", "MRSAM", 1
-- if aID is not 0 or false? then it will do all airfields if "AIRFIELDS"
-- if aID is a number it will use that airfield ID instead of all airfields
-- if aID is a number and you tell it "FOB" or "DEPOT" or "FACTORY" or "OIL"
-- it will use the index of that specific location to spawn something
-- if you are using a structure name to spawn something and no aID specified
-- it will just pick a random one from the list (used at mission start to randomize)
-- but make sure that the actual position in the database is actually present
-- or it will overflow and error
function Add_SAM(useSide, kindOf,  whichArea, aID)
    if whichArea == "AIRFIELDS" then
        local Airfields = Get_Airfields(useSide)
        local aF = {}

        if Airfields == false then
        return false
        end

        if aID == 0 then
            for airports = 1, #AIRFIELDS[useSide].POS do
                local aF = AIRFIELDS[useSide].POS[airports]
                local aFName = AIRFIELDS[useSide].NAME[airports]

                --local newZone = Create_TZ(aF.z, aF.x, aF.y, 35000)
                local newPoly = aFName .. " POLY"
                local polyPoints = {}
                polyPoints = mist.getGroupPoints(newPoly)
                --local samSpot = mist.getRandPointInCircle(aF, 10) -- the new unit coord
                ACTIVE_FORCES[useSide][kindOf].NAME[airports] = useSide .. " " .. kindOf .. " " .. GID
                ACTIVE_FORCES[useSide][kindOf].POS[airports] = mist.getRandomPointInPoly(polyPoints)
                GID = GID + 1
            end
        end

        if aID ~= 0 then
            
            for searchData = 1, #AIRFIELDS[useSide].ID do
                local lengthArrayGroups = #ACTIVE_FORCES[useSide][kindOf].POS
                local foundID = AIRFIELDS[useSide].ID[searchData]
                    if foundID == aID then
                        local aFName = AIRFIELDS[useSide].NAME[searchData]
                        local newPoly = aFName .. " POLY"
                        local polyPoints = {}
                        polyPoints = mist.getGroupPoints(newPoly)
                        ACTIVE_FORCES[useSide][kindOf].NAME[lengthArrayGroups + 1] = useSide .. " " .. kindOf .. " " .. GID
                        ACTIVE_FORCES[useSide][kindOf].POS[lengthArrayGroups + 1] = mist.getRandomPointInPoly(polyPoints)
                        GID = GID + 1
                    end
            end
        end
    end
    
    if whichArea ~= "AIRFIELDS" then
        local arrLength = #ACTIVE_FORCES[useSide][kindOf]

        local newPos = {}

        if aID ~= 0 then
        newPos = STRUCTURES[useSide][whichArea].POS[aID]
        else
        local rand = mist.random(1,#STRUCTURES[useSide][whichArea])
        newPos = STRUCTURES[useSide][whichArea].POS[rand]
        end

        ACTIVE_FORCES[useSide][kindOf].NAME[arrLength + 1] = useSide .. " " .. kindOf .. " " .. GID
        ACTIVE_FORCES[useSide][kindOf].POS[arrLength + 1] = newPos
        GID = GID + 1
    end
end -- end func


function Create_SAM(useSide, kindOf)
    --show_data(newCoord)
    for forces = 1, #ACTIVE_FORCES[useSide][kindOf].POS do

        local newGroupData = {}
        local rand = mist.random(1,#SAM[useSide][kindOf])
        newGroupData = mist.getGroupTable(SAM[useSide][kindOf][rand])

        local newCoord = {}
        newCoord = ACTIVE_FORCES[useSide][kindOf].POS[forces]

    

        --show_data(newCoord)

        local offsetX = {}
        local offsetY = {}

        for unitNumber, unitData in pairs(newGroupData.units) do -- for each unit index, and unit data
            offsetX[unitNumber] = newGroupData.units[1].x - newGroupData.units[unitNumber].x
            offsetY[unitNumber] = newGroupData.units[1].y - newGroupData.units[unitNumber].y
        end

        for unitNumber, unitData in pairs(newGroupData.units) do
        
            newGroupData.units[unitNumber].x = newCoord.x + offsetX[unitNumber]
            newGroupData.units[unitNumber].y = newCoord.y + offsetY[unitNumber]
        end




        newGroupData.country = Get_Country(useSide)
        newGroupData.category = 2

        --[[
        AIRPLANE      = 0,
        HELICOPTER    = 1,
        GROUND_UNIT   = 2,
        SHIP          = 3,
        STRUCTURE     = 4
        --]]
        
        newGroupData.clone = true
        newGroupData.name = ACTIVE_FORCES[useSide][kindOf].NAME[forces]
        --newGroupData.route = ACTIVE_FORCES[useSide][kindOf].ROUTE[forces]
        local newGroup = mist.dynAdd(newGroupData)
        Group.activate(Group.getByName(newGroupData.name))
        newGroup.lateActivation = false
        newGroup.visible = true
        --local data = mist.utils.serialize("data", newGroupData) -- debug to show us our table
       -- trigger.action.outText(data,35, true)
	end

end -- end func

    function random_markers(_mindistance, _maxdistance)
    local zonetouse = ""
    local mindist = 0
    local maxdist = 0
    local mindist2 = 0
    local maxdist2 = 0
    local mindist3 = 0
    local maxdist3 = 0
    local unitPos = {}
    local decision = ""
    local unitstouse = ""
    local delay = 0
    local groupToUse = {}
    local groupsInPlay = mist.DBs.dynGroupsAdded
    local groupchoice = mist.random(1, #groupsInPlay)
    groupToUse = groupsInPlay[groupchoice]

    unittouse = Group.getByName(groupToUse.groupName) 
    --side = Group.getCoalition(groupToUse.groupName)

    if unittouse == nil then
    return
    end

    mindist = _mindistance
    maxdist = _maxdistance
    mindist2 = mindist + 7
    maxdist2 = maxdist + 7
    mindist3 = mindist + 14
    maxdist3 = maxdist + 14
    direction = math.random(1,4)
    delay = math.random(5,15)

    local side = Group.getCoalition(unittouse)
    --dynaFRONT.log:info("Marker for $1", side)


    unitPos = mist.getLeadPos(unittouse)

    if unitPos == nil then
    return
    end

    if side == 2 then
        -- if direction == 1 then
           trigger.action.smoke({x=unitPos.x + math.random(mindist,maxdist), y= land.getHeight({x = unitPos.x, y = unitPos.z}), z=unitPos.z + math.random(mindist,maxdist)}, trigger.smokeColor.Blue)
     end
     

     if side == 1 then
        -- if direction == 1 then
           trigger.action.smoke({x=unitPos.x + math.random(mindist,maxdist), y= land.getHeight({x = unitPos.x, y = unitPos.z}), z=unitPos.z + math.random(mindist,maxdist)}, trigger.smokeColor.Red)
     end
     end



function Randomized_Alt(oldAlt, min, max, precision)
    newAlt = mist.random(min, max)
    
    newAlt = math.ceil(precision * newAlt/precision)
    newAlt = oldAlt - newAlt
    --trigger.action.outText(newAlt,35, false)
    if newAlt <= 1000 then
        newAlt = 1000
    end

    --show_debug(newAlt)
    
    return newAlt

end -- end func

function Roll_Dice(min, max, chance)
actualRoll = mist.random(min, max)

if actualRoll >= chance then
    return true
end
    return false
end -- end func


function Garbage_Collect(useSide, table)

    

end -- end func


function Randomized_Vec2(vec2, radius, innerRadius)
    local randomizedPoint = mist.getRandPointInCircle(vec2, radius, innerRadius)
    --show_data(randomizedPoint)
    return randomizedPoint
    
    end -- end func


function Get_Airfields(useSide)
    AIRFIELDS[useSide] = {}
    AIRFIELDS[useSide].POS = {}
    AIRFIELDS[useSide].ID = {}
    AIRFIELDS[useSide].NAME = {}
    local coal_airfields = coalition.getAirbases(sideToCoalition(useSide))
    --local bmbrstrike_airfields = {}
    -- loop over all coalition airfields
    for i = 1, #coal_airfields do
      -- get name of airfield
      AIRFIELDS[useSide].NAME[i] = coal_airfields[i]:getName()
      AIRFIELDS[useSide].ID[i] = Airbase.getID(coal_airfields[i])
      AIRFIELDS[useSide].POS[i] = Airbase.getPoint(coal_airfields[i])
      --if not string.match(af_name, "FARP") then
        -- check if a triggerzone exists with that exact name
       -- if mist.DBs.zonesByName[af_name] then
          -- add it to our airfield list for bmbrstrike
       --   bmbrstrike_airfields[#bmbrstrike_airfields + 1] = coal_airfields[i]
     --   end
    --  end
    --show_data(AIRFIELDS[useSide][i])
    end

    if #coal_airfields == 0 then
        return false
    else
        return true
    end
end


    function sideToCoalition(useSide)
        if useSide == "NEUTRAL" then return coalition.side.NEUTRAL
        elseif useSide == "RED" then return coalition.side.RED
        elseif useSide == "BLUE" then return coalition.side.BLUE
        end
      end


      --timer.scheduleFunction(Radio_Add, nil, timer.getTime() + 5)
      --timer.scheduleFunction(Radio_Check, nil, timer.getTime() + 2)
      function Dump_ME_Groups()
        for gName, gData in pairs(mist.DBs.groupsByName) do
            mist.debug.writeGroup(gName)	
        end
    end


function Dump(grpName)
    mist.debug.writeGroup(grpName)
    --mist.debug.dumpDBs()
end

      --dump() // used to dump all group data

 

      function Create_Templated_Thing(useSide, kindOf, whichArea)
        grpNameToClone = ""

        Add_Force(useSide, kindOf, "INDUSTRY", 200, 2)
    arrLength = #ACTIVE_FORCES[useSide][kindOf].POS
    newCoord = ACTIVE_FORCES[useSide][kindOf].POS[arrLength]
    --local newClone = mist.getGroupData(grpNameToClone)
    --local newCoord = mist.getRandomPointInZone(whichArea)

    if kindOf == "LRSAM" then
        grpNameToClone = useSide .. " LRSAM"
    end

    vars = 
    {
    units = newClone.units,
    country = Get_Country(useSide) ,
    category = "vehicle", 
    name = grpNameToClone .. " " .. GID,
    --groupId = number groupId, 
    x = newCoord.x,
    y = newCoord.y,
    clone = true,
    --route = table route,
    }
    
    local newGroup = mist.dynAdd(vars)


      end -- end func